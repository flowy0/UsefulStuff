
## Remove Docker Desktop for Mac

Remove Docker Desktop
```
brew uninstall --cask docker
```


## Rancher Desktop 
Install Rancher Desktop
```
brew install --cask rancher
```

Install Docker cli, plugins and credential helper
```
brew install docker
brew install docker-credential-helper

brew install docker-compose
```

Setup engine as dockerd
![image](https://github.com/flowy0/UsefulStuff/assets/9532712/6d623874-9aab-4edf-ba42-e010858995df){width=600}

`docker context use rancher-desktop`

Hit into a bug 

Hit an issue when running a spark image
`docker run -it flowy0/pyspark:3.3-nlp-test-v1  bash`

```
Non-spark-on-k8s command provided, proceeding in pass-through mode...
+ CMD=("$@")
+ exec /usr/bin/tini -s -- bash
[FATAL tini (1)] PR_SET_CHILD_SUBREAPER is unavailable on this platform. Are you using Linux >= 3.4?
```

## Try Colima


```
brew install colima
```

```
colima start
```

Check that docker engine is running
`docker version`

```
Client: Docker Engine - Community
 Version:           23.0.6
 API version:       1.41 (downgraded from 1.42)
 Go version:        go1.20.4
 Git commit:        ef23cbc431
 Built:             Thu May  4 10:51:27 2023
 OS/Arch:           darwin/arm64
 Context:           colima

Server:
 Engine:
  Version:          20.10.20
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.18.7
  Git commit:       03df974ae9e6c219862907efdd76ec2e77ec930b
  Built:            Wed Oct 19 02:58:31 2022
  OS/Arch:          linux/arm64
  Experimental:     false
 containerd:
  Version:          v1.6.8
  GitCommit:        9cd3357b7fd7218e4aec3eae239db1f68a5a6ec6
 runc:
  Version:          1.1.4
  GitCommit:        5fd4c4d144137e991c4acebb2146ab1483a97925
 docker-init:
  Version:          0.19.0
  GitCommit:
```

Fixing the docker plugins

extract after running `docker`
```
Invalid Plugins:
  buildx      failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-buildx: no such file or directory
  compose     failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-compose: no such file or directory
  dev         failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-dev: no such file or directory
  extension   failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-extension: no such file or directory
  init        failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-init: no such file or directory
  sbom        failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-sbom: no such file or directory
  scan        failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-scan: no such file or directory
  scout       failed to fetch metadata: fork/exec /Users/g/.docker/cli-plugins/docker-scout: no such file or directory
```

```
brew install docker-compose

# this is generated by homebrew
mkdir -p ~/.docker/cli-plugins
ln -sfn /opt/homebrew/opt/docker-compose/bin/docker-compose ~/.docker/cli-plugins/docker-compose
```

```
brew install docker-buildx
# this is generated by homebrew
mkdir -p ~/.docker/cli-plugins
ln -sfn /opt/homebrew/opt/docker-buildx/bin/docker-buildx ~/.docker/cli-plugins/docker-buildx
```

### Colima with different backend engines

#### Create multiple docker contexts 
```bash
# amd profile 
colima start --profile amd --arch amd --cpu 4 --memory 8 --disk 80

# default profile
colima start --arch aarch64 --vm-type=vz --vz-rosetta --cpu 4 --memory 12 --disk 80
```

#### Switch docker context 
```bash
docker context ls
```

Output:
```
NAME            DESCRIPTION                               DOCKER ENDPOINT                               ERROR
colima *        colima                                    unix:///Users/g/.colima/default/docker.sock
colima-amd      colima [profile=amd]
```

Switch accordingly
```bash
docker context use colima
#or
docker context use colima-amd


```


